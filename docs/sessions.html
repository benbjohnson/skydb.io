<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Aggregating Sessions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="/javascripts/all.js" type="text/javascript"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', "UA-34296486-1"]);


  _gaq.push(['_trackPageview']);
  _gaq.push(['_trackPageLoadTime']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head>

  
  

  <body class="docs docs_sessions">
    <div class="container">
      <div class="row">
        <div class="span8 offset2">
          <header>
            <h1>
              <a href="/">Sky</a>
              <br class="visible-phone"/>
              <small><span class="hidden-phone">Open Source, </span>Behavioral Database</small>
            </h1>
          </header>

          <ul class="nav nav-pills">
            <li class="">
              <a href="/">Home</a>
            </li>
            <li class="active">
              <a href="/docs">
                <span class="hidden-phone">Documentation</span>
                <span class="visible-phone">Docs</span>
              </a>
            </li>
            <li class="">
              <a href="/blog">Blog</a>
            </li>
            <li><a class="disable hidden-phone" href="/sky-0.2.1.tar.gz">Download</a></li>
            <li>
              <a href="https://github.com/skydb/sky">
                <span class="hidden-phone">Repository</span>
                <span class="visible-phone">Repo</span>
              </a>
            </li>
          </ul>

          <hr class="soften">
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span8 offset2">
          
            <h2>Aggregating Sessions</h2>
          
          <h3>What are Sessions?</h3>

<p>Sessions are a common term in web applications but the idea applies to any kind of behavior analysis.
We typically want to view how someone acts within a block of time where they are active.
By constraining our analysis to a block of active time we can see what actions caused someone to stop being active (e.g. leaving your web site).</p>

<h3>How to Use Sessions</h3>

<p>Session analysis is simple in Sky.
You just wrap your cursor in an extra loop and that becomes your context.
Here&#39;s the basic flow of session analysis in Lua:</p>
<div class="highlight"><pre><span class="k">function</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="n">event</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">:</span><span class="n">event</span><span class="p">()</span>

  <span class="c1">-- Set up how long a user must be idle (e.g. have no events) </span>
  <span class="c1">-- before their session is considered done. Let&#39;s set our</span>
  <span class="c1">-- session for two hours (7,200 seconds).</span>
  <span class="n">cursor</span><span class="p">:</span><span class="n">set_session_idle</span><span class="p">(</span><span class="mi">7200</span><span class="p">)</span>

  <span class="c1">-- This outer loop will be executed once for every session.</span>
  <span class="k">while</span> <span class="n">cursor</span><span class="p">:</span><span class="n">next_session</span><span class="p">()</span> <span class="k">do</span>
    <span class="c1">-- This inner loop will be executed once for every individual</span>
    <span class="c1">-- event in the session. It will automatically exit once the</span>
    <span class="c1">-- session is over.</span>
    <span class="k">while</span> <span class="n">cursor</span><span class="p">:</span><span class="nb">next</span><span class="p">()</span> <span class="k">do</span>
      <span class="c1">-- Do something with the current event data.</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p><br/>
<a href="lua.html">Â« Prev <span class="hidden-phone">(Data Processing in Lua)</span></a></p>

        </div>
      </div>
    </div><!-- /container -->
    
    
    
    <footer>
    </footer>
  </body>
</html>

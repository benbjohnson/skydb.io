<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bulk Importing Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="/javascripts/all.js" type="text/javascript"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', "UA-34296486-1"]);


  _gaq.push(['_trackPageview']);
  _gaq.push(['_trackPageLoadTime']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head>

  
  

  <body class="docs docs_import">
    <div class="container">
      <div class="row">
        <div class="span8 offset2">
          <header>
            <h1>
              <a href="/">Sky</a>
              <br class="visible-phone"/>
              <small><span class="hidden-phone">Open Source, </span>Behavioral Database</small>
            </h1>
          </header>

          <ul class="nav nav-pills">
            <li class="">
              <a href="/">Home</a>
            </li>
            <li><a class="disable hidden-phone" href="http://demo.skydb.io">Demo</a></li>
            <li class="active">
              <a href="/docs">
                <span class="hidden-phone">Documentation</span>
                <span class="visible-phone">Docs</span>
              </a>
            </li>
            <li class="">
              <a href="/blog">Blog</a>
            </li>
            <li><a class="disable hidden-phone" href="/sky-0.2.3.tar.gz">Download</a></li>
            <li>
              <a href="https://github.com/skydb/sky">
                <span class="hidden-phone">Repository</span>
                <span class="visible-phone">Repo</span>
              </a>
            </li>
          </ul>

          <hr class="soften">
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span8 offset2">
          
            <h2>Bulk Importing Data</h2>
          
          <h3>Overview</h3>

<p>You can use the Sky API to add individual events but if you have your events in a flat file such as a CSV or tab-delimited format, you can use the Sky importer to make the process easier.
The Sky importer allows you to import using a predefined translation format or you can can define your own as described below.</p>

<p>File types are automatically detected by extension.
Tab-delimited formats end in <code>.tsv</code> and <code>.txt</code>.
All other extensions default to CSV format.</p>

<h3>Using the Importer</h3>

<p>The standard Sky import format recognizes <code>object_id</code> and <code>timestamp</code> as standard header columns.
It will also automatically associate any header column that matches one of the formats:</p>

<ul>
<li><code>data.&lt;property_name&gt;:&lt;data_type&gt;</code></li>
<li><code>action.&lt;property_name&gt;:&lt;data_type&gt;</code></li>
</ul>

<p>The default data type is <code>string</code> but you can also use <code>int</code>, <code>float</code> &amp; <code>boolean</code>.
The timestamp field is parsed using the <a href="https://github.com/mojombo/chronic">Chronic</a> gem so you can generally format your dates how you choose.</p>

<p>Here&#39;s an example CSV data import file:</p>
<div class="highlight"><pre>object_id,timestamp,action.name,action.purchase_amount:float,data.gender,data.age:int,data.rewards_member:boolean
100,2012-01-01T00:00:00Z,/index.html,0,male,35,false
100,2012-01-01T00:01:00Z,/signup.html,9.95,male,35,true
100,2012-01-01T00:02:00Z,/buy.html,9.95,male,35,true
101,2012-02-01T07:35:00Z,/buy.html,100.00,female,23,false
</pre></div>
<p>When you run the loader, you can specify the table name with the command line argument (<code>--table</code>) or the loader will ask you when you run.
If the table already exist, the loader will ask if you wish to append the data to the table or overwrite the existing table.
You can specify <code>--append</code> and <code>--overwrite</code> in the command line as well.</p>

<p>Your import command should look something like this:</p>
<div class="highlight"><pre><span class="nv">$ </span>sky import --table my_tbl --format sky mydata.csv
</pre></div>
<h3>The Format File</h3>

<p>There are two types of formats in Sky.
First there are named formats.
These are format files built into the gem.
You can find their definitions in the <code>lib/skydb/import/transforms</code> folder of the gem.
Currently there is just the standard <code>sky</code> format.</p>

<p>The second is a format file.
If you pass a path into the <code>--format</code> argument then you can specify a YAML file that describes the mapping from each row of the input file to it&#39;s corresponding Sky event.</p>

<p>The format file has three parts: <code>fields</code>, <code>require</code> &amp; <code>translate</code>.
The <code>fields</code> section maps an input column (and data type) on the right to an output field on the right.
You can also specify inline ruby code to convert an input field to an output field by enclosing it in curly braces.</p>

<p>The following format file converts a CSV file with headers <code>Path</code>, <code>UserID</code>, <code>Timestamp</code> and <code>FollowerCount</code> to a Sky event:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">object_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UserID:int</span>
  <span class="l-Scalar-Plain">timestamp</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Timestamp:date</span>
  <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Path</span>
    <span class="l-Scalar-Plain">follower_count</span><span class="p-Indicator">:</span> <span class="s">&quot;{</span><span class="nv"> </span><span class="s">input[&#39;FollowerCount&#39;].to_i</span><span class="nv">  </span><span class="s">}&quot;</span>
</pre></div>
<p>The <code>translate</code> section provides you with a free form area to convert input to output:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">translate</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
  <span class="no">if input[&#39;UserID&#39;] != &#39;&#39;</span>
    <span class="no">output[&#39;object_id&#39;] = input[&#39;UserID&#39;].to_i</span>
  <span class="no">else</span>
    <span class="no">output[&#39;object_id&#39;] = input[&#39;AlthernateUserIDColumn&#39;].to_i</span>
  <span class="no">end</span>
</pre></div>
<p>And finally, if you have special libraries you need for your conversion, you can list them in the <code>require</code> section like this:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">uri</span><span class="p-Indicator">,</span> <span class="nv">active_support</span><span class="p-Indicator">]</span>
</pre></div>
<p>If you write a file format for a common data format, please consider sending the Sky project a pull request on GitHub!</p>

<p><br/>
<a href="query.html">« Prev <span class="hidden-phone">(Behavioral Query Language)</span></a>
<span class="pull-right"><a href="skybox.html">Next <span class="hidden-phone">(Exploring Your Data with Skybox)</span> »</a></span></p>

        </div>
      </div>
    </div><!-- /container -->
    
    
    
    <footer>
    </footer>
  </body>
</html>
